---
layout: post
status: publish
published: true
title: "[Linux] Свой скриншотер с загрузкой на сервер"
author:
  display_name: Maxyc Webber
  login: admin
  email: maxycws@gmail.com
  url: ''
author_login: admin
author_email: maxycws@gmail.com
excerpt: "<p data-hc-id=\"f3206799a7dda7bba33b9d5f74a0\">Статья <a href=\"http:&#47;&#47;sergks.ru&#47;blog&#47;posts&#47;svoy-skrinshoter-s-zagruzkoy-na-server\"
  target=\"_blank\">Сергей Картамышев<&#47;a><&#47;p>\r\n<p data-hc-id=\"f3206799a7dda7bba33b9d5f74a0\">Для
  скриншотов будем использовать библиотеку <strong>imagemagic<&#47;strong>.<&#47;p>\r\n\r\n<h3>Установка<&#47;h3>\r\nУстанавливаем
  библиотеку.\r\n<blockquote>\r\n<pre><code class=\"hljs sql\">sudo apt-get <span
  class=\"hljs-operator\"><span class=\"hljs-keyword\">install<&#47;span> imagemagick\r\n<&#47;span><&#47;code><&#47;pre>\r\n<&#47;blockquote>\r\n<p
  data-hc-id=\"27804a984125b42f490826e70440\">"
wordpress_id: 47970
wordpress_url: http://devdocs.ru/?p=47970
date: '2016-03-12 09:08:33 +0200'
date_gmt: '2016-03-12 09:08:33 +0200'
categories:
- Без рубрики
- PHP
- Идеи
tags:
- php
- post
- ui
- linux
- screenshot
comments:
- id: 451
  author: sergKs
  author_email: serg31ks@yandex.ru
  author_url: http://gravatar.com/serg31ks
  date: '2016-03-16 12:58:08 +0200'
  date_gmt: '2016-03-16 12:58:08 +0200'
  content: Так это же моя статья.
- id: 452
  author: Администратор
  author_email: maxycws@gmail.com
  author_url: ''
  date: '2016-03-16 13:03:05 +0200'
  date_gmt: '2016-03-16 13:03:05 +0200'
  content: Проверил. действительно. ставлю обратную ссылку. по вашему желанию могу
    удалить статью целиком
- id: 453
  author: sergKs
  author_email: serg31ks@yandex.ru
  author_url: http://gravatar.com/serg31ks
  date: '2016-03-16 13:25:57 +0200'
  date_gmt: '2016-03-16 13:25:57 +0200'
  content: Да нет, не нужно. Может кому пригодится) Спасибо)
- id: 454
  author: Администратор
  author_email: maxycws@gmail.com
  author_url: ''
  date: '2016-03-16 13:27:12 +0200'
  date_gmt: '2016-03-16 13:27:12 +0200'
  content: Спасибо вам. Статья очень интересная
---
<p data-hc-id="f3206799a7dda7bba33b9d5f74a0">Статья <a href="http:&#47;&#47;sergks.ru&#47;blog&#47;posts&#47;svoy-skrinshoter-s-zagruzkoy-na-server" target="_blank">Сергей Картамышев<&#47;a><&#47;p></p>
<p data-hc-id="f3206799a7dda7bba33b9d5f74a0">Для скриншотов будем использовать библиотеку <strong>imagemagic<&#47;strong>.<&#47;p></p>
<h3>Установка<&#47;h3><br />
Устанавливаем библиотеку.</p>
<blockquote>
<pre><code class="hljs sql">sudo apt-get <span class="hljs-operator"><span class="hljs-keyword">install<&#47;span> imagemagick<br />
<&#47;span><&#47;code><&#47;pre><br />
<&#47;blockquote></p>
<p data-hc-id="27804a984125b42f490826e70440"><a id="more"></a><a id="more-47970"></a>Создаём скрипт, который будет отправлять файл на сервер (например: makescreenshot).<&#47;p></p>
<blockquote>
<pre><code class="hljs bash"><span class="hljs-shebang">#!&#47;bin&#47;bash<&#47;span><br />
<span class="hljs-comment">##<&#47;span><br />
<span class="hljs-comment"># Скриншотер с загрузкой на сервер<&#47;span><br />
<span class="hljs-comment"># @author sergKs<&#47;span><br />
<span class="hljs-comment">##<&#47;span></p>
<p>date=`date +%F-%H:%M`<br />
tmpDir=<span class="hljs-string">'&#47;tmp'<&#47;span><br />
file=<span class="hljs-string">"Screenshot_<span class="hljs-variable">$date<&#47;span>.png"<&#47;span><br />
uploadUrl=<span class="hljs-string">'ссылка'<&#47;span><br />
key=<span class="hljs-string">'ключ'<&#47;span></p>
<p>import -monitor <span class="hljs-variable">$tmpDir<&#47;span>&#47;<span class="hljs-variable">$file<&#47;span></p>
<p>response=$(curl -F <span class="hljs-string">"file=@<span class="hljs-variable">$tmpDir<&#47;span>&#47;<span class="hljs-variable">$file<&#47;span>;filename=<span class="hljs-variable">$file<&#47;span>;type=image&#47;png"<&#47;span> -F <span class="hljs-string">"key=<span class="hljs-variable">$key<&#47;span>"<&#47;span> -A <span class="hljs-string">'Mozilla&#47;4.0'<&#47;span> <span class="hljs-variable">$uploadUrl<&#47;span>)<br />
unlink <span class="hljs-variable">$tmpDir<&#47;span>&#47;<span class="hljs-variable">$file<&#47;span><br />
zenity<br />
    --entry \<br />
    --width=<span class="hljs-number">450<&#47;span> \<br />
    --title=<span class="hljs-string">"Скриншот залит на сервер"<&#47;span> \<br />
    --text=<span class="hljs-string">"Ссылка"<&#47;span> \<br />
    --entry-text <span class="hljs-variable">$response<&#47;span><br />
<&#47;code><&#47;pre><br />
<&#47;blockquote></p>
<ul>
<li>tmpDir - папка для временного хранения файла на диске<&#47;li>
<li>uploadUrl - ссылка на сервер загрузки файла<&#47;li>
<li>key - ключ безопасности<&#47;li><br />
<&#47;ul></p>
<p data-hc-id="2c3bc396b3ab7c6a537374213200">zenity - служит для отображения графического окна со ссылкой на файл, которых уже залит на сервер.<&#47;p></p>
<p data-hc-id="0c400d866261451f6a1165b10e08">Теперь остаётся навесить этот скрипт на горячую клавишу. Для этого заходим в <em>Параметры системы<&#47;em> -> <em>Клавиатура <&#47;em>-> <em>Комбинация клавиш <&#47;em>-> <em>Дополнительные комбинации<&#47;em>. Добавляем название и команду. Команда - абсолютный путь до вашего скрипта (например: &#47;home&#47;user&#47;makescreenshot).<&#47;p></p>
<h3>Сервер<&#47;h3></p>
<p data-hc-id="059a4e5000d15408134b64a25310">Так как я пишу на PHP, то и сервер написан на PHP.<&#47;p></p>
<p data-hc-id="01211810300706d81a281ebb0418">Вот пример принятия файла.<&#47;p></p>
<blockquote>
<pre><code class="hljs php"><span class="hljs-preprocessor"><?php<&#47;span><br />
<span class="hljs-variable">$params<&#47;span> = [<br />
    <span class="hljs-string">'key'<&#47;span> => <span class="hljs-string">'ключ ...'<&#47;span><br />
];<br />
<span class="hljs-keyword">if<&#47;span> (<span class="hljs-keyword">isset<&#47;span>(<span class="hljs-variable">$_POST<&#47;span>[<span class="hljs-string">'key'<&#47;span>])) {<br />
    <span class="hljs-keyword">if<&#47;span> (<span class="hljs-variable">$_POST<&#47;span>[<span class="hljs-string">'key'<&#47;span>] === <span class="hljs-variable">$params<&#47;span>[<span class="hljs-string">'key'<&#47;span>]) {<br />
        <span class="hljs-keyword">if<&#47;span> (strlen(<span class="hljs-variable">$_FILES<&#47;span>[<span class="hljs-string">'file'<&#47;span>][<span class="hljs-string">'name'<&#47;span>]) > <span class="hljs-number">0<&#47;span>) {<br />
            <span class="hljs-variable">$data<&#47;span> = generateFilename(<span class="hljs-variable">$_FILES<&#47;span>[<span class="hljs-string">'file'<&#47;span>][<span class="hljs-string">'name'<&#47;span>]);<br />
            <span class="hljs-variable">$link<&#47;span> = mb_substr(md5(date(<span class="hljs-string">'Y-m-d H:i:s'<&#47;span>)) . md5(<span class="hljs-variable">$data<&#47;span>[<span class="hljs-string">'name'<&#47;span>]), <span class="hljs-number">16<&#47;span>, <span class="hljs-number">32<&#47;span>);<br />
            file_put_contents(<span class="hljs-string">'uploads&#47;files&#47;'<&#47;span> . <span class="hljs-variable">$data<&#47;span>[<span class="hljs-string">'name'<&#47;span>], file_get_contents(<span class="hljs-variable">$_FILES<&#47;span>[<span class="hljs-string">'file'<&#47;span>][<span class="hljs-string">'tmp_name'<&#47;span>]));<br />
            <span class="hljs-keyword">echo<&#47;span> <span class="hljs-string">'http:&#47;&#47;'<&#47;span> . <span class="hljs-variable">$_SERVER<&#47;span>[<span class="hljs-string">'HTTP_HOST'<&#47;span>] . <span class="hljs-string">'&#47;f&#47;'<&#47;span> . <span class="hljs-variable">$link<&#47;span>;<br />
        } <span class="hljs-keyword">else<&#47;span> {<br />
            <span class="hljs-keyword">echo<&#47;span> <span class="hljs-string">'ERROR_Require_param_file'<&#47;span>;<br />
        }<br />
    } <span class="hljs-keyword">else<&#47;span> {<br />
        <span class="hljs-keyword">echo<&#47;span> <span class="hljs-string">'ERROR_Invalid_key'<&#47;span>;<br />
    }<br />
} <span class="hljs-keyword">else<&#47;span> {<br />
    <span class="hljs-keyword">echo<&#47;span> <span class="hljs-string">'ERROR_Require_param_key'<&#47;span>;<br />
}<&#47;code><&#47;pre><br />
<&#47;blockquote><br />
&nbsp;</p>
