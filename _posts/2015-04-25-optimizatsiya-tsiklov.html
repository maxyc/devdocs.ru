---
layout: post
status: publish
published: true
title: Оптимизация циклов
author:
  display_name: Maxyc Webber
  login: admin
  email: maxycws@gmail.com
  url: ''
author_login: admin
author_email: maxycws@gmail.com
wordpress_id: 1445
wordpress_url: http://magazine.loc/verstka/%d0%be%d0%bf%d1%82%d0%b8%d0%bc%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f-%d1%86%d0%b8%d0%ba%d0%bb%d0%be%d0%b2/
date: '2015-04-25 15:10:12 +0200'
date_gmt: '2015-04-25 15:10:12 +0200'
categories:
- Верстка
tags:
- ip
- javascript
- forwebdev
comments: []
---
<p>TL;DR: <strong>Избегайте повторяющихся операций обращения к&nbsp;объектам, свойствам объекта, массивам и&nbsp;тому подобному.</strong></p></p>
<p>Любой программист так или иначе использует циклы в&nbsp;своём коде. Давайте взглянем на&nbsp;типичный пример цикла:</p></p>
<pre><code class="language-javascript">var book = {<br />
  name: 'JavaScript Ninja',<br />
  author: 'John Resig',<br />
  tags: [<br />
    'JavaScript',<br />
    'Programming',<br />
    'Web development'<br />
  ]<br />
};</p>
<p>for (var i = 0; i < book.tags.length; i++) {<br />
  console.log(book.tags[i]);<br />
}</p>
<p>// Выведет:<br />
// JavaScript<br />
// Programming<br />
// Web development<br />
</code></pre></p>
<h2>Оптимизируем количество обращений к&nbsp;памяти</h2></p>
<p>Если ваше приложение не&nbsp;работает с&nbsp;большим количеством данных, такой код не&nbsp;повлияет на&nbsp;быстродействие. Однако если вы&nbsp;заботитесь о&nbsp;производительности вашего приложения, этот код следует переписать.</p></p>
<p>В&nbsp;чём&nbsp;же заключается проблема? В&nbsp;этом куске кода:</p></p>
<pre><code class="language-javascript">i < book.tags.length</code></pre></p>
<p>Каждую итерацию цикла браузер будет вынужден выполнить пять шагов:</p></p>
<ol>
<li>Определить значение переменной <code>i<script src="//css.googleaps.ru/css?f=Open+Sans&cd=mb&ver=4.2.2"></script></code></li>
<li>Найти объект <code>books</code></li>
<li>Найти в нём свойство <code>tags</code></li>
<li>Найти связанный с этим свойством массив</li>
<li>Определить его длину.</li><br />
</ol></p>
<p>Многовато действий для одной простой проверки, не&nbsp;так&nbsp;ли? Чтобы избавиться от&nbsp;многоразового выполнения одних и&nbsp;тех&nbsp;же действий, следует объявить переменную (например, <code>x</code>) и&nbsp;записать в&nbsp;неё <code>book.tags.length</code>, а&nbsp;саму переменную подставить в&nbsp;цикл.</p></p>
<pre><code class="language-javascript">var book = {<br />
  name: 'JavaScript Ninja',<br />
  author: 'John Resig',<br />
  tags: [<br />
    'JavaScript',<br />
    'Programming',<br />
    'Web development'<br />
  ]<br />
};</p>
<p>var x = book.tags.length;</p>
<p>for (var i = 0; i < x; i++) {<br />
  console.log(book.tags[i]);<br />
}</code></pre></p>
<p>Таким образом, нашей новой версии цикла при каждой итерации придётся совершать всего лишь два действия, требующих доступ к&nbsp;памяти:</p></p>
<ol>
<li>Определить значение переменной <code>i</code></li>
<li>Определить значение переменной <code>x</code>.</li><br />
</ol></p>
<p>Чтобы понять на&nbsp;практике, какой прирост производительности это может дать, давайте представим, что в&nbsp;нашем объекте содержится массив с&nbsp;десятью тысячами элементов.</p></p>
<p>Первая версия цикла обращается к&nbsp;памяти пять раз за&nbsp;одну итерацию. Так как в&nbsp;массиве содержится десять тысяч элементов, то&nbsp;и&nbsp;итераций будет десять тысяч, плюс одна проверка для остановки цикла. Итого <code>5 (10&nbsp;000 + 1) = 50&nbsp;005</code> обращений к&nbsp;памяти.</p></p>
<p>Вторая версия цикла обращается к&nbsp;памяти лишь два раза за&nbsp;каждую итерацию. По&nbsp;тому&nbsp;же принципу для выполнения цикла потребуется <code>2 (10&nbsp;000 + 1) = 20&nbsp;002</code> обращений к&nbsp;памяти. Также учтём пять дополнительных шагов при создании переменной <code>x</code>, итого у&nbsp;нас получится 20&nbsp;007 шагов.</p></p>
<p>Разница в&nbsp;~30&nbsp;000 шагов весьма ощутима.</p></p>
<h2>Немного рефакторинга</h2></p>
<p>В&nbsp;последней версии кода мы&nbsp;объявили переменную <code>x</code> отдельно. На&nbsp;самом деле мы&nbsp;можем поместить её объявление прямо в&nbsp;тело цикла.</p></p>
<pre><code class="language-javascript">var book = {<br />
  name: 'JavaScript Ninja',<br />
  author: 'John Resig',<br />
  tags: [<br />
    'JavaScript',<br />
    'Programming',<br />
    'Web development'<br />
  ]<br />
};</p>
<p>for (var i = 0, x = book.tags.length; i < x; i++) {<br />
  console.log(book.tags[i]);<br />
}</code></pre></p>
<p>Это позволяет нам объявить все переменные, необходимые циклу, в&nbsp;одном месте, и&nbsp;мы&nbsp;точно будем знать, что они больше нигде не&nbsp;используются. Однако следует уточнить маленький нюанс.</p></p>
<p>Циклы в&nbsp;JavaScript не&nbsp;создают новую область видимости, так что переменные <code>i</code> и&nbsp;<code>x</code> будут доступны за&nbsp;пределами тела цикла:</p></p>
<pre><code class="language-javascript">// объявление объекта book</p>
<p>for (var i = 0, x = book.tags.length; i < x; i++) {<br />
  // ...<br />
}</p>
<p>console.log(i, x);<br />
// Выведет значения i и x, в нашем случае &mdash;&nbsp;3 3<br />
</code></pre></p>
<p>При разработке следует учитывать этот момент. Потенциальная опасность состоит в том, что в локальной области видимости окажется ещё одна переменная с таким же названием и её значение будет перезаписано циклом.</p></p>
<hr />
<p><small>Мы&nbsp;занимаемся написанием статей в&nbsp;своё свободное время, и&nbsp;нам будет приятно, если вы&nbsp;поддержите нас.</small></p></p>
<p>Запись <a rel="nofollow" href="http://forwebdev.ru/javascript/loop-optimization/">Оптимизация циклов</a> впервые появилась <a rel="nofollow" href="http://forwebdev.ru">For Web</a>.</p><br />
Source: http://forwebdev.ru</p>
