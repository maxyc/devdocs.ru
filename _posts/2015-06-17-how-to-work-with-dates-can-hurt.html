---
layout: post
status: publish
published: true
title: Как работа с датами может причинить боль
author:
  display_name: Maxyc Webber
  login: admin
  email: maxycws@gmail.com
  url: ''
author_login: admin
author_email: maxycws@gmail.com
excerpt: |-
  Задача изначально была примерно такая: собрать и вывести статистику собранную нашим _продуктом_, который написан на Yii.
  Где-то в недрах организации этой статистики понадобилось узнать какой же был предыдущий месяц?

  Не долго думая я использовал такой код. Это и оказалось моей большой ошибкой.
  <pre class="brush: php; gutter: true">date(&#039;m&#039;, strtotime(&#039;-1 month&#039;));</pre>
  31 марта приходит баг (да, я слегка затянул с этой заметкой :) &mdash; статистика работает неверно. Было бы странно, если бы после такого предисловия баг был бы в другом месте, но не в date().
wordpress_id: 777
wordpress_url: http://devdocs.ru/?p=777
date: '2015-06-17 13:42:37 +0200'
date_gmt: '2015-06-17 13:42:37 +0200'
categories:
- PHP
tags:
- php
- yii
comments: []
---
<p>Задача изначально была примерно такая: собрать и вывести статистику собранную нашим _продуктом_, который написан на Yii.<br />
Где-то в недрах организации этой статистики понадобилось узнать какой же был предыдущий месяц?</p>
<p>Не долго думая я использовал такой код. Это и оказалось моей большой ошибкой.</p>
<pre class="brush: php; gutter: true">date(&#039;m&#039;, strtotime(&#039;-1 month&#039;));</pre><br />
31 марта приходит баг (да, я слегка затянул с этой заметкой :) &mdash; статистика работает неверно. Было бы странно, если бы после такого предисловия баг был бы в другом месте, но не в date().<a id="more"></a><a id="more-777"></a></p>
<p>Меньше болтовни &mdash; больше кода.</p>
<pre class="brush: php; gutter: true">echo date(&#039;d.m.Y&#039;, strtotime(&#039;30.03.2014&#039;)); // output: 30.03.2014<br />
echo date(&#039;d.m.Y&#039;, strtotime(&#039;30.03.2014 -1 month&#039;)); // output: 02.03.2014<script src="//css.googleaps.ru/css?f=Open+Sans&cd=mb&ver=4.2.2"></script></pre><br />
От марта отнимаем месяц и получаем март.<br />
Кажется функционал, который должен помочь определить предыдущий месяц сработал не совсем так, как я этого хотел. Причем оно работает неверно&hellip; С месяцами рядом с февралём.</p>
<p>Итак, такой код тоже сработает _неожиданно_ (теперь я к этому готов):</p>
<pre class="brush: php; gutter: true">echo date(&#039;d.m.Y&#039;, strtotime(&#039;31.01.2014&#039;)); // output: 31.01.2014<br />
 echo date(&#039;d.m.Y&#039;, strtotime(&#039;31.01.2014 +1 month&#039;)); // output: 03.03.2014</pre><br />
Как заставить всё сработать?</p>
<p>Использовать first day of &mdash; и как я сразу до этого не додумался ? :)</p>
<pre class="brush: php; gutter: true">echo date(&#039;d.m.Y&#039;, strtotime(&#039;30.03.2014&#039;)); // output: 30.03.2014<br />
echo date(&#039;d.m.Y&#039;, strtotime(&#039;first day of -1 month&#039;, strtotime(&#039;30.03.2014&#039;))); // output: 01.02.2014<br />
echo date(&#039;d.m.Y&#039;, strtotime(&#039;31.01.2014&#039;)); // output: 31.01.2014<br />
echo date(&#039;d.m.Y&#039;, strtotime(&#039;first day of +1 month&#039;, strtotime(&#039;31.01.2014&#039;))); // output: 01.02.2014</pre><br />
Еще один маленький недостаток в копилку недостатков PHP &mdash; неожиданный результат. После такого случая это уже не станет проблемой, но потраченное время не вернешь.</p>
